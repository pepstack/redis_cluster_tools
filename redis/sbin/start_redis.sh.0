#!/bin/bash
# redis cluster uri: [redis://host:port@cluster/]

# Treat unset variables as an error
set -o nounset

# Treat any error as exit
set -o errexit

_selfdir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
. "$_selfdir/cluster_env.sh"

echo "[redis://{NODEHOST}@$CLUSTERID] Starting {NODEID} ..."

ports=({PORTS})

for port in "${ports[@]}"
do
    echo "[redis://{NODEHOST}@$CLUSTERID] Starting {NODEID}:$port ..."

    cd "$CLUSTERHOME/" && "./bin/redis-server" "./conf/redis-{NODEID}-$port.conf"

    echo "[redis://{NODEHOST}@$CLUSTERID] {NODEID}:$port started"
done

echo "[redis://{NODEHOST}@$CLUSTERID] {NODEID} started"